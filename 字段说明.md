# 订单薄数据字段说明

## 数据修正说明

根据真实市场数据的惯例，我们已经修正了字段定义：

### 修正前（错误）
- `amount`: 累计成交量 ❌
- `volume`: 累计成交额 ❌

### 修正后（正确）✅
- `volume`: 累计成交量（整数，股数）
- `amount`: 累计成交额（浮点数，金额）

---

## 订单薄Snapshot字段

每个snapshot包含以下字段：

### 时间和标识
- `timestamp`: 时间戳
- `symbol`: 股票代码

### 五档买卖盘
- `bid1_p` ~ `bid5_p`: 买一价 ~ 买五价
- `bid1_v` ~ `bid5_v`: 买一量 ~ 买五量
- `ask1_p` ~ `ask5_p`: 卖一价 ~ 卖五价
- `ask1_v` ~ `ask5_v`: 卖一量 ~ 卖五量

### 成交信息
- `last_price`: 最新成交价
- **`volume`**: 累计成交量（整数，股数）
  - 从开盘到当前时刻的累计交易量
  - 数据类型：int64
  - 单位：股
  
- **`amount`**: 累计成交额（浮点数，金额）
  - 从开盘到当前时刻的累计交易金额
  - 数据类型：float64
  - 单位：元
  - 计算公式：amount ≈ volume × 平均成交价

### 计算字段（由处理脚本添加）
- `spread`: 买卖价差 = ask1_p - bid1_p
- `mid_price`: 中间价 = (ask1_p + bid1_p) / 2
- `spread_bps`: 相对价差（基点）= (spread / mid_price) × 10000

---

## 区间统计字段

每个10分钟区间的统计信息：

### 基本信息
- `interval_id`: 区间编号（1-20）
- `session`: 时段（上午/下午）
- `start_time`: 区间开始时间
- `end_time`: 区间结束时间

### 成交统计
- **`snapshot_count`**: 该区间内的snapshot数量
  - 理论值：每3秒一个，10分钟应有200个

- **`interval_total_volume`**: 该区间的总成交量（股数）
  - 计算方法：取该区间最后一个snapshot的volume值
  - 因为volume是累计值，所以区间最后的值代表该区间的总成交量
  - 单位：股

- **`target_order_volume`**: 目标下单量
  - 计算公式：target_order_volume = interval_total_volume × 1%
  - 这是TWAP算法在该区间内需要执行的总下单量
  - 单位：股

- **`total_amount`**: 该区间的总成交额
  - 计算方法：取该区间最后一个snapshot的amount值
  - 单位：元

### 其他统计
- `total_volume`: 该区间所有snapshot的volume总和
- `avg_volume`: 该区间snapshot的平均volume
- `std_volume`: volume的标准差

---

## 数据处理流程

### 1. 原始数据（generate_orderbook_data.py）
生成模拟订单薄数据，时间范围：9:30 - 15:00，每100ms一个snapshot

### 2. 数据采样（process_orderbook_data.ipynb）
- 定义20个10分钟交易区间
  - 上午：10:00-11:30（9个区间）
  - 下午：13:00-14:50（11个区间）
- 每个区间内每3秒采样一次snapshot
- 计算每个区间的统计信息

### 3. 输出文件
- `orderbook_sampled_10min_intervals.parquet`: 采样后的snapshot数据
- `interval_statistics.parquet` / `.csv`: 区间统计数据

---

## 使用示例

```python
import pandas as pd

# 读取数据
df = pd.read_parquet('orderbook_sampled_10min_intervals.parquet')
interval_stats = pd.read_parquet('interval_statistics.parquet')

# 查看某个区间的数据
interval_1 = df[df['interval_id'] == 1]
print(f"区间1的数据量: {len(interval_1)}")
print(f"区间1的目标下单量: {interval_1['target_order_volume'].iloc[0]:.2f} 股")

# 查看volume和amount的关系
print(f"volume类型: {df['volume'].dtype}")  # 应该是int64
print(f"amount类型: {df['amount'].dtype}")  # 应该是float64
print(f"volume是否为整数: {(df['volume'] == df['volume'].astype(int)).all()}")  # True
```

---

## 注意事项

1. **volume是整数**：成交量必须是整数（股数），不能有小数
2. **amount是浮点数**：成交额是金额，可以有小数
3. **累计值特性**：volume和amount都是累计值，随时间单调递增
4. **区间统计**：区间的总成交量 = 该区间最后一个snapshot的volume值
5. **目标下单量**：TWAP算法在每个区间内需要执行的交易量是区间总成交量的1%

